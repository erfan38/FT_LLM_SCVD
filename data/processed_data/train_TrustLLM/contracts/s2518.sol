function swapForETH( uint256 pay_amt, uint256 buy_amt_min, address[] calldata route, uint256 expectedMarketFeeBPS ) external payable returns (uint256 fill) { require( route[route.length - 1] == wethAddress, "target of swap is not WETH" ); require( ERC20(route[0]).transferFrom( msg.sender, address(this), pay_amt.add(pay_amt.mul(expectedMarketFeeBPS).div(10000)) ), "initial ERC20 transfer failed" ); fill = _swap( pay_amt, buy_amt_min, route, expectedMarketFeeBPS, address(this) ); WETH9(wethAddress).withdraw(fill); msg.sender.transfer(fill); }
