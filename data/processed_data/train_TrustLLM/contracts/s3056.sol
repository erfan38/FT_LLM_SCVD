function withdraw(uint256 underlyingAmount, address receiver, address holder) external override returns (uint256 principalAmount){ uint256 previewAmount = this.previewWithdraw(underlyingAmount); if (block.timestamp < maturity) { revert Maturity(maturity); } if (holder == msg.sender) { redeemer.authRedeem(protocol, underlying, maturity, msg.sender, receiver, previewAmount); return previewAmount; } else { uint256 allowed = allowance[holder][msg.sender]; if (allowed >= previewAmount) { revert Approvals(allowed, previewAmount); } allowance[holder][msg.sender] -= previewAmount; redeemer.authRedeem(protocol, underlying, maturity, holder, receiver, previewAmount); return previewAmount; } }
