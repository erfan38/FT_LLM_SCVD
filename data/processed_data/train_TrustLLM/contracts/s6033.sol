function _globalAccrue(GlobalState storage globalState, ERC20 producerToken) internal { uint256 totalSupply = producerToken.totalSupply(); uint256 lastUpdate = globalState.lastUpdate; uint256 lastSupply = globalState.lastSupply; if (block.timestamp != lastUpdate || totalSupply != lastSupply) { uint256 rewards = globalState.rewards + (block.timestamp - lastUpdate) * lastSupply; globalState.lastUpdate = block.timestamp.safeCastTo32(); globalState.lastSupply = totalSupply.safeCastTo224(); globalState.rewards = rewards; emit GlobalAccrue( producerToken, block.timestamp, totalSupply, rewards ); } }
