function pushDraft(address account, uint256 rsrAmount) internal returns (uint256 index, uint64 availableAt) { draftRSR += rsrAmount; uint256 newTotalDrafts = (draftRate * draftRSR) / FIX_ONE; uint256 draftAmount = newTotalDrafts - totalDrafts; totalDrafts = newTotalDrafts; CumulativeDraft[] storage queue = draftQueues[draftEra][account]; index = queue.length; uint192 oldDrafts = index > 0 ? queue[index - 1].drafts : 0; uint64 lastAvailableAt = index > 0 ? queue[index - 1].availableAt : 0; availableAt = uint64(block.timestamp) + unstakingDelay; if (lastAvailableAt > availableAt) { availableAt = lastAvailableAt; } queue.push(CumulativeDraft(uint176(oldDrafts + draftAmount), availableAt)); }
